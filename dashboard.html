<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Snippy | Dashboard</title>
    <link rel="stylesheet" href="dash.css">
</head>
<body>
    <!-- NAVIGATION -->
    <div id="nav" class="nav-class">
        <img src="../Images/SNIPPY-removebg-preview.png" alt="logo">
        <ul>
            <li>YOUR SNIPPETS</li>
            <li>PROFILE</li>
            <li>SETTINGS</li>
            <li><input type="text" id="searchInput" placeholder="Search..."></li>
        </ul>
    </div>

    <!-- CREATE SNIPPET BUTTON -->
    <div style="text-align:center; margin:20px;">
        <button id="createBtn" style="padding:10px 20px; font-size:16px; border-radius:10px; background:#4a90e2; color:white; border:none; cursor:pointer;">Create New Snippet</button>
    </div>

    <!-- DASHBOARD -->
    <div id="dash" class="dass-cl"></div>

    <!-- MODAL FOR CREATING/EDITING SNIPPET -->
    <div id="modal" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);justify-content:center;align-items:center;">
        <div style="background:white; padding:20px; border-radius:15px; max-width:500px; width:90%;">
            <h2 id="modalTitle">New Snippet</h2>
            <input type="text" id="snippetTitleInput" placeholder="Snippet Title" style="width:100%; padding:10px; margin:10px 0; font-size:16px; border-radius:8px; border:1px solid #ccc;">
            <input type="text" id="snippetLangInput" placeholder="Language (e.g., JavaScript)" style="width:100%; padding:10px; margin:10px 0; font-size:16px; border-radius:8px; border:1px solid #ccc;">
            <textarea id="snippetCodeInput" placeholder="Code here..." style="width:100%; height:150px; padding:10px; font-size:14px; border-radius:8px; border:1px solid #ccc;"></textarea>
            <div style="text-align:right; margin-top:10px;">
                <button id="saveSnippet" style="padding:8px 15px; border:none; border-radius:8px; background:#4a90e2; color:white; cursor:pointer;">Save</button>
                <button id="cancelSnippet" style="padding:8px 15px; border:none; border-radius:8px; background:#e94e77; color:white; cursor:pointer;">Cancel</button>
            </div>
        </div>
    </div>

    <script>
        let snippets = JSON.parse(localStorage.getItem("snippets")) || [];

        const dash = document.getElementById('dash');
        const searchInput = document.getElementById('searchInput');

        const modal = document.getElementById('modal');
        const modalTitle = document.getElementById('modalTitle');
        const titleInput = document.getElementById('snippetTitleInput');
        const langInput = document.getElementById('snippetLangInput');
        const codeInput = document.getElementById('snippetCodeInput');
        const saveBtn = document.getElementById('saveSnippet');
        const cancelBtn = document.getElementById('cancelSnippet');
        const createBtn = document.getElementById('createBtn');

        let editIndex = null;

        function saveSnippets() {
            localStorage.setItem("snippets", JSON.stringify(snippets));
        }

        function renderSnippets(filter="") {
            dash.innerHTML = '';
            snippets.filter(snip => snip.title.toLowerCase().includes(filter.toLowerCase()))
                .forEach((snippet, index) => {
                    const card = document.createElement('div');
                    card.className = 'snippet-card';
                    card.innerHTML = `
                        <h3>${snippet.title}</h3>
                        <p class="lang">${snippet.language}</p>
                        <pre>${snippet.code.substring(0,100)}${snippet.code.length>100?"...":""}</pre>
                        <div class="card-actions">
                            <button onclick="previewSnippet(${index})">Preview</button>
                            <button onclick="openEdit(${index})">Edit</button>
                            <button onclick="deleteSnippet(${index})">Delete</button>
                        </div>
                    `;
                    dash.appendChild(card);
                });
        }

        function previewSnippet(index) {
            localStorage.setItem("previewSnippet", JSON.stringify(snippets[index]));
            window.location.href = "preview.html";
        }

        function openEdit(index) {
            editIndex = index;
            modalTitle.textContent = "Edit Snippet";
            titleInput.value = snippets[index].title;
            langInput.value = snippets[index].language;
            codeInput.value = snippets[index].code;
            modal.style.display = "flex";
        }

        function deleteSnippet(index) {
            if(confirm("Are you sure you want to delete this snippet?")) {
                snippets.splice(index, 1);
                saveSnippets();
                renderSnippets(searchInput.value);
            }
        }

        function openCreate() {
            editIndex = null;
            modalTitle.textContent = "New Snippet";
            titleInput.value = "";
            langInput.value = "";
            codeInput.value = "";
            modal.style.display = "flex";
        }

        saveBtn.addEventListener('click', () => {
            const title = titleInput.value.trim();
            const lang = langInput.value.trim();
            const code = codeInput.value.trim();
            if(title && lang && code) {
                if(editIndex !== null) {
                    snippets[editIndex] = {title, language: lang, code};
                } else {
                    snippets.push({title, language: lang, code});
                }
                saveSnippets();
                renderSnippets(searchInput.value);
                modal.style.display = "none";
            } else {
                alert("Please fill in all fields!");
            }
        });

        cancelBtn.addEventListener('click', () => modal.style.display = "none");
        createBtn.addEventListener('click', openCreate);

        searchInput.addEventListener('input', () => renderSnippets(searchInput.value));

        renderSnippets();
    </script>
</body>
</html>
